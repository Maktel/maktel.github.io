---
theme: post
published: true
title: Things learned – August 2018
---
# 9 August

### Using grid layout
Grid layout is way better than flex or any other way to lay out elements. It seems much easier after I used it to create a very specific layout with clear purpose.
```css
.wrapper {
  display: grid;
  grid-template-columns: 1fr 2fr 1fr;
  grid-template-rows: auto;
}

.always_middle_column {
  grid-column: 2;
}

.first_row_wide {
  grid-row: 1;
  grid-column-start: 1;
  grid-column-end: 4;
}
```

### React 16 error handling
https://reactjs.org/blog/2017/07/26/error-handling-in-react-16.html

### Better way to handle injectable class names
Haven't tested it yet in the field, but it seems like a good idea: build a static version of a component with hardcoded class names, then move the default implementations to `defaultProps` as values for properties. That way a component has a default look, but can be easily styled.

---

# 8 August

### You cannot extend selectors from outside media query in Sass
When you are writing a rule in a media query and you want to reference a class that is outside the query, you have to you mixins or other tricks, as `@extend` is not allowed (at least in libsass 3.5.4).

### Found something that looks like a solution to component class name problem
https://simonsmith.io/handling-props-and-class-names-in-react/

### Add whitespace in span in JSX
I wanted to render a `span` with a colon and space as children: `<span>; </span>`. However, it seems like JSX removes the space. I didn't want a non-breaking space (`&nbsp;`), as it would make word-wrapping look bad. I have tried escaping with `": "` or `` `; ` ``, but it didn't work.
I believe I have settled for `&nbsp;`, but right now using `React.createElement('span', null, '; ')` seems like a interesting solution which could solve my problem.

When I tried it again the day later, both plain `<span>` and `.createElement()` versions worked. Strange.

### Escape backtick in Markdown
I couldn't make a following snippet in this very post:
```
`; `
```
without a trailing space in inline code block.

---

## 7 August

### Empty arrays and empty objects evaluate to true
Javascript's objects evaluate to true when put inside a conditional expression (arrays are objects after all). To test if an object is empty (has no own properties), you can either use lodash or other library, or use following snippet:
```javascript
function isEmptyObject(o) {
  return Object.keys(o).length === 0 && o.constructor === Object;
}
```

### Triggering application wide events
Redux's application level store is for data. Redux enables triggering events through reducers responding to certain actions:
* some code dispatches an action
* the action enters reducer
* reducer(s) change(s) application state
* component had previously subscribed to Redux's store by `connect(mapStateToProps, ...)`
* component reacts to change in their props by `componentDidUpdate(prevProps, prevState)` and similar lifecycle functions (because it can compare current props with previous)

This has a drawback of having to pollute global store with action-specific data. 
_Of course calling any functions in reducer is a big no-no._

I haven't found a good solution for it yet, however I believe callbacks are the way to go.

### What is `snapshot` in React lifecycle's `componentDidUpdate(_, _, snapshot)`?

---

## 6 August

### Node – check if path starts with one of the values from an array

#### Clever version
```javascript
const apiPaths = ["/foo/bar/", "/biz/baz"];
const isPathToApi = apiPaths.reduce(
  (res, apiPath) => res || parsedUrl.pathname.startsWith(apiPath),
  false, // initial value for res
);

if (isPathToApi) {
  ...
}
```

### Mercurial tips 'n' tricks
https://www.mercurial-scm.org/wiki/TipsAndTricks#Avoid_merging_autogenerated_.28binary.29_files_.28PDF.29

### How to trigger file download in browser?
https://stackoverflow.com/questions/20508788/do-i-need-content-type-application-octet-stream-for-file-download/20509354#20509354

---

## 3 August

### Commit your changes before doing anything
It happened at least once to every person using version control – losing their changes. Commit your files, guys!

### Named shelves in Mercurial
You can name patches saved in shelve:
```bash
hg shelve -n 'named_patch'
```

### Javascript: Arrow functions don't have their own arguments object
This one can be painful: I have been recently using `Function.arguments` object to inspect contents of values passed to function. Unforunately, arrow functions do not have their own `arguments` object; instead, `arguments` is a reference to the enclosing scope's arguments array.

One hack you can use to list all passed values is to use rest parameter:
```javascript
function foo(n) {
  const f = (...args) => {
    console.log(arguments); // prints { "0": 5, <rest of the object>}
    console.log(args); // prints [10]
  }
  f(10);
}
foo(5);
```

### Re-render on `setState()`
By default, every time you call `setState()`, `render()` is called. However rendering is split in two steps: virtual DOM re-render and browser DOM. If nothing changes in virtual DOM (rendering returns the same vDOM tree), browser DOM is not updated – this is where the speed of React comes from.

You can prevent re-rendering using custom implementation of `shouldComponentUpdate(nextProps, nextState)` which is called before each state change application. The function should return boolean value, depending on the need to re-render.

### Function vs arrow function
https://stackoverflow.com/questions/34361379/arrow-function-vs-function-declaration-expressions-are-they-equivalent-exch
For now: if I understand correctly, arrow functions are like C++ lambda's with [&] and no own scope.

### `WeakMap` and `WeakSet` built-in objects
https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/WeakMap

---

## 2 August

### React's setState is asynchronous
#### Value
`setState()` can accept an object with values to set or a callback which will receive previous state. Using objects is fine if you use constants/literals for new values; for modifications of previous state callbacks are recommended. 

```javascript
component.setState((prevState, currentProps) => {counter: prevState.counter + 1});
```

Rationale: Since `setState()` is asynchronous, there can be multiple queued operations. If you call setState with plain object, other calls can overwrite your modification (especially during operations like incrementation)

```javascript
// DON'T

constructor() {
  this.state = {
    counter: 0,
  };
}

component.setState({counter: this.state.counter + 1});
component.setState({counter: this.state.counter + 2});
// -> possible this.state.counter values after setState is applied: 2, 3
// second call can overwrite the first one
```

#### Application
Since state can be updated anytime, you cannot use it synchronously. To do an operation on modified state (eg. on updated counter), pass callback as a second argument to `setState()`. This callback will be called after state update.

```javascript
component.setState(
  {counter: 0},
  () => { console.log('second', this.state.counter); // zero }
);
console.log('first', this.state.counter); // old value
```

### mapDispatchToProps()
https://stackoverflow.com/questions/39419237/what-is-mapdispatchtoprops

### Immutability
https://github.com/kolodny/immutability-helper
https://github.com/facebook/immutable-js –Facebook's library providing immutable types
